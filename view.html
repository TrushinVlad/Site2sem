<!DOCTYPE html>
<html>

<head>
    <title>Пользователь</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <meta charset="utf-8" />
</head>

<body style="margin: 10px 10px;">
    <h1 id="NameL">... [...]</h1>
    <h3>Контакты</h3>
    <p id="Mail">Почта: ...</p>
    <p id="Mail2">Доп. почта: ...</p>
    <h4>Информация</h4>
    <p id="Info">...</p>
    <h4>Дополнительные достижения</h4>
    <p id="Achiv">...</p>
    <button type="button" class="btn btn-info" onclick="location.href='/'">Назад</button>
    <button type="submit" class="btn btn-info" id="Delete">Удалить</button>
    <button type="submit" class="btn btn-info" id="Edit">Редактировать</button>
    <script>

        let url = window.location.href;
        let ID = 0;
        console.log(url.replace("/view", "/"));
        let r = fetch(url.replace("/view", "/"));
        let rr = r.then((res) => { console.log(res); return res.json(); });
        rr.then((data) => {
            console.log(data);
            console.log(data.data.length);
            if (data.status == 0) {
                ID = data.data[0].ID;
                document.getElementById("NameL").textContent = data.data[0].Name + " [" + ID + "]";
                document.getElementById("Mail").innerHTML = "Почта: " + data.data[0].Email;
                document.getElementById("Mail2").innerHTML = "Доп. почта: ";// + data.data[0].EmailSec;
                document.getElementById("Info").innerHTML = data.data[0].Info;
                document.getElementById("Achiv").innerHTML = data.data[0].Achievements;
                document.getElementById("Edit").onclick = function(){ location.href='/users/' + ID + '/edit'; };
            }
        });

        document.getElementById("Delete").onclick = function (e) {
            let request = new XMLHttpRequest();
            let user = JSON.stringify({ ID: ID });
            request.open("delete", "/users/" + ID, true);
            request.setRequestHeader("Content-Type", "application/json");
            request.addEventListener("load", function () {
                let receivedUser = JSON.parse(request.response);
                console.log("ответ: " + request.response);
                let S = receivedUser.status;
                if (S == 0) {
                    //успешно отправлено
                    window.location = '/';
                }
                else {
                    if (S == 255) console.log("Неизвестная ошибка при отправке.");
                    if (S == 1) console.log("Ошибка в базе данных.");
                }
            });
            console.log(user);
            request.send(user);
            e.preventDefault();
        }
    </script>
</body>

</html>